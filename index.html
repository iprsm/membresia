<script>
    async function sendToTrello() {
        const name = document.getElementById('name').value;
        const position = document.getElementById('position').value;
        const baptismDate = formatDate(document.getElementById('baptismDate').value);
        const cpf = document.getElementById('cpf').value;
        const phone = document.getElementById('phone').value;
        const address = document.getElementById('address').value;
        const dizimista = document.getElementById('dizimista').checked ? "Sim" : "Não";
        const ebenezer = document.getElementById('ebenezer').checked ? "Sim" : "Não";
        
        const apiKey = 580b929cd3fd23399eb5a3cbeac8e3df;
        const token = ATTA1a5ed79744840ebea79fcedb6c88ead3bddca932a9d5ab5191dbb8722dfd9083E14CC719;
        const listId = 67891789508c1cc4f9ab7d59;

        const cardData = {
            name: `Cadastro: ${name}`,
            desc: `**Nome:** ${name}\n**CPF:** ${cpf}\n**Telefone:** ${phone}\n**Endereço:** ${address}\n**Data de Batismo:** ${baptismDate}\n**Função:** ${position}\n**Dizimista:** ${dizimista}\n**Ebenezer:** ${ebenezer}`,
            idList: listId,
            key: apiKey,
            token: token
        };

        try {
            const response = await fetch('https://api.trello.com/1/cards', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(cardData)
            });

            if (response.ok) {
                alert('Cadastro enviado para o Trello com sucesso!');
            } else {
                alert('Erro ao enviar cadastro para o Trello.');
            }
        } catch (error) {
            alert('Erro na comunicação com o Trello. Verifique sua conexão.');
        }
    }

    document.getElementById('downloadButton').addEventListener('click', async () => {
        await sendToTrello();
        sendToWhatsApp();
    });

    function sendToWhatsApp() {
        const name = document.getElementById('name').value;
        const position = document.getElementById('position').value;
        const message = `Segue carteirinha para análise:\nNome: ${name}\nFunção: ${position}`;
        const phoneNumber = '+5511979654420';
        const whatsappURL = `https://api.whatsapp.com/send?phone=${phoneNumber}&text=${encodeURIComponent(message)}`;
        window.open(whatsappURL, '_blank');
    }
</script>
